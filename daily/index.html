<!DOCTYPE html>
<html>
<head>
    <title>ʔayʔaǰuθəm today</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../style.css">
</head>
<body>
    
<div class="app-layout">
    <nav class="sidebar">
        <div class="sidebar-header">Ayalingo</div>
        <div class="nav-links">
            <a href="../" class="nav-item">Lessons</a>
            <a href="../soundboard/" class="nav-item">Soundboard</a>
            <a href="./" class="nav-item active">Daily Practice</a>
        </div>
    </nav>

    <main class="main-content">
        <div class="page-container">
            <header class="page-header">
                <h2>Daily Practice</h2>
            </header>

            <div class="scroll-viewport">
                <div id="task-display" class="task-card">
                    <p id="task-label" style="text-transform: uppercase; color: #2c3e50; font-weight: bold; font-size: 1.5rem">Today's Practice</p>
                    <div id="task-content" class="task-text">Loading...</div>
                    
                    <div class="btn-group">
                        <button class="big-btn secondary" onclick="showRandom()">Random</button>
                        <button class="big-btn" onclick="showDaily()">Today</button>
                        <button class="big-btn secondary" onclick="toggleAll()">Show All</button>
                    </div>
                </div>

                <div id="all-tasks" class="all-tasks-list">
                    <h3>All Practices</h3>
                    <ul id="list-container"></ul>
                </div>
            </div>
        </div>
    </main>
</div>

    <script>
        let allTasks = [];

        // 1. Fetch the tasks from your JSON file
        fetch('tasks.json')
            .then(res => res.json())
            .then(data => {
                allTasks = data;
                showDaily(); // Initialize with the daily task
                populateAllList();
            });

        function showDaily() {
            // Use the date string to create a "seed"
            const today = new Date().toISOString().slice(0, 10); 
            const seed = today.split('-').join(''); // Turn it into a number: 20240520
            
            // Use math to pick an index that is consistent for everyone today
            const index = parseInt(seed) % allTasks.length;
            
            document.getElementById('task-label').innerText = "Today's Practice";
            document.getElementById('task-content').innerHTML = allTasks[index];
            document.getElementById('all-tasks').style.display = 'none';
        }

        function showRandom() {
            const index = Math.floor(Math.random() * allTasks.length);
            document.getElementById('task-label').innerText = "Random Practice";
            document.getElementById('task-content').innerHTML = allTasks[index];
        }

        function toggleAll() {
            const list = document.getElementById('all-tasks');
            list.style.display = list.style.display === 'block' ? 'none' : 'block';
        }

        function populateAllList() {
            const container = document.getElementById('list-container');
            container.innerHTML = ''; 
            allTasks.forEach(task => {
                const li = document.createElement('li');
                li.innerHTML = formatTaskForList(task);
                container.appendChild(li);
            });
        }

        // Helper: Converts iframes to links for the list view
        function formatTaskForList(taskHtml) {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = taskHtml;
            
            const iframes = tempDiv.querySelectorAll('iframe');
            
            iframes.forEach(iframe => {
                const link = document.createElement('a');
                link.href = iframe.src;
                link.target = "_blank";
                link.innerText = "Watch Video"; 
                
                link.style.fontWeight = "bold";
                link.style.display = "inline-block";
                link.style.marginTop = "5px";

                iframe.parentNode.replaceChild(link, iframe);
            });

            return tempDiv.innerHTML;
        }
    </script>
</body>
</html>